[TOC]

# XSS 跨站脚本

cross site：站点

server端：用户提交的文件是否有可执行的语句、过滤处理、非法字符



# SQL注入

后台进行拼接sql的查询语句、

攻击效果：数据泄露、写入数据库（给站点增加用户）



机制考虑不完善、没有对用户的提交做严格的处理



# 一个攻击的实例

C语言需要知道存储的数据需要多少空间、但是通常是无法判断的。所以这样输入会有问题、不知道输入的数据有多长，若超过给定长度，

```c
#include<stdio.h>
#include<stdlib.h>
#include<string.h>
//命令行argc 参数个数 argv 值、字符串数组 char* argv[]
int main(int argc, char** argv) { 
	//变量定义告诉了内存分配
	char y[10];
	//把输入的参数拷贝给y字符数组
	if (argc > 1) {
		//strcpy传递的是指针、没有传递长度，不管缓冲区有多长直接往里写
		//在复制的时候直接复制，写入式，超过长度直接覆盖
		//若覆盖的数据是内部控制数据、则会造成后果
		//写入越界是严重的安全性问题
		strcpy(y, argv[1]);
	}
}
```

附：

```bash
git clone  
% git 是程序 后面跟参数 命令行按空格作为分隔符
% argc 3 %
% argv git clone 
```



buffer is to small -> 指的是y太小了

vs如何指定命令行参数

```c
#include<stdio.h>
#include<stdlib.h>
#include<string.h>

int sub(char* x) {
	char y[10];
	//第二个参数是校验长度是否越界
	//此方法不会考虑越界？？？
	strcpy_s(y, strlen(x), x);
	return 0;
}
int main(int argc, char** argv) {
	if (argc > 1) {
		sub(argv[1]);
	}
	printf("exit");
}
```



如何去恢复程序的参数：

push指令

call指令：入栈返回地址

push ebp：构造程序的栈帧

sub esp xxx：分配局部变量的地址

y是局部变量、如果写超了



**安全漏洞都是在于一开始的设计不够完善**：

* 机制设计不完善：只想过完善功能、并没有想过安全性问题
* 程序员没有检查

> 功能性的bug好发现、安全性的bug不好发现





# 缓冲区溢出的漏洞程序

# CVE

Common Vulnerabilities & Exposures”公共漏洞和暴露

# CNNVD

国家信息安全漏洞库

# CNVD

[国家信息安全漏洞共享平台](http://www.baidu.com/link?url=SKk8s_QvhVUlBSXlLxFT0ybTLewrdjzobBwy3YiWMdUA-rztnNbudHLSDhF3wGE1)



# web的XSS

web开发

web的框架中最重要的是

.html 

http server是一个程序

httpd  /apache



windows上装bash

http的根目录、

启动httpd

netstat -ano / -l

端口的占用情况（80端口的关闭和监听）

httpd的目录可以放任何的html文件

127.0.0.1\a.html



区分服务器和客户端

去服务器取页面、根据html的标签标记在浏览器画界面、执行动态的脚本

传递的信息：http协议





## 作业



> 实验一：安装任何一种webserver、放一种静态的页面在里面、模拟html的加载过程（抓包看）
>
> 动态网站：服务器的html是由程序动态生成的
>
> 程序根据client的请求*新生成*html文件，基于数据库的信息
>
> 实验二：写动态的脚本
>
> php做一个乘法器 根据输入返回结果
>
> 看官方文档、简单
>
> get的全局变量
>
> php在nginx（比httpd更高级的web服务器、能处理静态页面、）
>
> php+nginx
>
> python的框架Django

CGI：C语言打印到控制台上的结果，重定义到网络页面

PHP：适合处理web、访问数据库



### 实验一

#### Apache

##### Apache的安装、配置与使用

* 广泛应用在计算机平台

*  The Apache HTTP Server ("*httpd*") 
* [下载]( http://httpd.apache.org/download.cgi ) 
  * 注：VC11，VS 2012编译器、VC14，VS 2015编译器、VC15，VS 2017编译器
* 配置
  * [教程](https://www.cnblogs.com/wcwnina/p/8044353.html) 
  * 输入httpd.exe会报错，所以更改http.conf的配置，将80端口改为88，因为报错我的80端口已被占用
  * 安装Apache的主服务
    ```bash
	httpd -k install
	```
* 利用命令行启动Apache服务
  ```bash
  httpd -k start
  % 结束httpd %
  httpd k- stop
  ```
* 在浏览器中输入`http://localhost:88`测试Apache服务是否启动

##### 抓包观察静态页面

* [Apache的基础信息](https://www.jianshu.com/p/3f52d597eed8)
* 默认发布文件

#### nginx

##### nginx的安装与配置
* 创建pid文件: nginx -c conf/nginx.conf
* 查看是否成功: tasklist /fi "imagename eq nginx.exe"

##### 抓包观察静态页面

#### flask+python


  
### 实验二

* 用php做动态加法器

* **flask对应后端是python，nginx对应后端是php**

#### windows下搭建nginx+php开发环境
https://www.cnblogs.com/wwjchina/p/9804576.html


# WEB框架

web开发

框架：把共性的东西解决了

我们只用解决个性的东西

MVT：数据模型->数据库的表结构（关系型数据库）

**核心：定义数据模型，便携功能列表，定义页面模板**

*MVC*全名是Model View Controller，是模型(model)－视图(view)－控制器(controller)：model模型，数据

> Django：自学、请同学来讲

ORM：object

定义数据对象

定义的类自动映射数据库的表结构

```python
from django.db import models

class Musician(models.Model):
    first_name = models.CharField(max_length=50)
    last_name = models.CharField(max_length=50)
    instrument = models.CharField(max_length=100)

class Album(models.Model):
    # 定义外键
    artist = models.ForeignKey(Musician, on_delete=models.CASCADE)
    name = models.CharField(max_length=100)
    release_date = models.DateField()
    num_stars = models.IntegerField()
```





# 二进制的缓冲区溢出





作业

* 静态html站点的建立
* 抓包器抓http请求响应的过程
* apache或nginx建立基本动态的web程序执行的过程、写一个简单的php（可以根据用户的请求动态生成页面）
* Django框架快速构建web应用